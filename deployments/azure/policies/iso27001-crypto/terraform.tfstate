{
  "version": 4,
  "terraform_version": "1.13.3",
  "serial": 20,
  "lineage": "bf714c5e-4717-db2f-7bd4-567b48653859",
  "outputs": {
    "custom_policy_definitions": {
      "value": {
        "aks_encryption_at_host": "/subscriptions/8c781f5c-b4c9-4184-9915-7bb3b64a885e/providers/Microsoft.Authorization/policyDefinitions/iso27001-aks-encryption-at-host",
        "disk_cmk_required": "/subscriptions/8c781f5c-b4c9-4184-9915-7bb3b64a885e/providers/Microsoft.Authorization/policyDefinitions/iso27001-disk-cmk-required",
        "kusto_cmk_required": "/subscriptions/8c781f5c-b4c9-4184-9915-7bb3b64a885e/providers/Microsoft.Authorization/policyDefinitions/iso27001-kusto-cmk-required",
        "kusto_disk_encryption": "/subscriptions/8c781f5c-b4c9-4184-9915-7bb3b64a885e/providers/Microsoft.Authorization/policyDefinitions/iso27001-kusto-disk-encryption",
        "vm_encryption_audit": "/subscriptions/8c781f5c-b4c9-4184-9915-7bb3b64a885e/providers/Microsoft.Authorization/policyDefinitions/custom-vm-encryption-audit"
      },
      "type": [
        "object",
        {
          "aks_encryption_at_host": "string",
          "disk_cmk_required": "string",
          "kusto_cmk_required": "string",
          "kusto_disk_encryption": "string",
          "vm_encryption_audit": "string"
        }
      ]
    },
    "enforcement_mode": {
      "value": "DoNotEnforce",
      "type": "string"
    },
    "policy_assignments": {
      "value": {
        "aks_azure_policy_addon": "/subscriptions/8c781f5c-b4c9-4184-9915-7bb3b64a885e/providers/Microsoft.Authorization/policyAssignments/iso27001-aks-policy-addon",
        "aks_encryption_at_host": "/subscriptions/8c781f5c-b4c9-4184-9915-7bb3b64a885e/providers/Microsoft.Authorization/policyAssignments/iso27001-aks-encrypt-host",
        "disk_cmk": "/subscriptions/8c781f5c-b4c9-4184-9915-7bb3b64a885e/providers/Microsoft.Authorization/policyAssignments/iso27001-disk-cmk",
        "keyvault_purge_protection": "/subscriptions/8c781f5c-b4c9-4184-9915-7bb3b64a885e/providers/Microsoft.Authorization/policyAssignments/iso27001-kv-purge-protect",
        "keyvault_soft_delete": "/subscriptions/8c781f5c-b4c9-4184-9915-7bb3b64a885e/providers/Microsoft.Authorization/policyAssignments/iso27001-kv-soft-delete",
        "kusto_cmk": "/subscriptions/8c781f5c-b4c9-4184-9915-7bb3b64a885e/providers/Microsoft.Authorization/policyAssignments/iso27001-kusto-cmk",
        "kusto_disk_encryption": "/subscriptions/8c781f5c-b4c9-4184-9915-7bb3b64a885e/providers/Microsoft.Authorization/policyAssignments/iso27001-kusto-encryption",
        "sql_tde_cmk": "/subscriptions/8c781f5c-b4c9-4184-9915-7bb3b64a885e/providers/Microsoft.Authorization/policyAssignments/iso27001-sql-tde-cmk",
        "storage_cmk": "/subscriptions/8c781f5c-b4c9-4184-9915-7bb3b64a885e/providers/Microsoft.Authorization/policyAssignments/iso27001-storage-cmk",
        "storage_disable_public": "/subscriptions/8c781f5c-b4c9-4184-9915-7bb3b64a885e/providers/Microsoft.Authorization/policyAssignments/iso27001-storage-no-public",
        "storage_https": "/subscriptions/8c781f5c-b4c9-4184-9915-7bb3b64a885e/providers/Microsoft.Authorization/policyAssignments/iso27001-storage-https",
        "vm_encryption_audit": "/subscriptions/8c781f5c-b4c9-4184-9915-7bb3b64a885e/providers/Microsoft.Authorization/policyAssignments/vm-encryption-audit"
      },
      "type": [
        "object",
        {
          "aks_azure_policy_addon": "string",
          "aks_encryption_at_host": "string",
          "disk_cmk": "string",
          "keyvault_purge_protection": "string",
          "keyvault_soft_delete": "string",
          "kusto_cmk": "string",
          "kusto_disk_encryption": "string",
          "sql_tde_cmk": "string",
          "storage_cmk": "string",
          "storage_disable_public": "string",
          "storage_https": "string",
          "vm_encryption_audit": "string"
        }
      ]
    },
    "subscription_id": {
      "value": "/subscriptions/8c781f5c-b4c9-4184-9915-7bb3b64a885e",
      "type": "string"
    }
  },
  "resources": [
    {
      "mode": "data",
      "type": "azurerm_client_config",
      "name": "current",
      "provider": "provider[\"registry.terraform.io/hashicorp/azurerm\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "client_id": "04b07795-8ddb-461a-bbee-02f9e1bf7b46",
            "id": "Y2xpZW50Q29uZmlncy9jbGllbnRJZD0wNGIwNzc5NS04ZGRiLTQ2MWEtYmJlZS0wMmY5ZTFiZjdiNDY7b2JqZWN0SWQ9NGI1NWQxNGEtNjYwNy00YTU2LTg2MTUtOWM5NTU1NjFkYTgwO3N1YnNjcmlwdGlvbklkPThjNzgxZjVjLWI0YzktNDE4NC05OTE1LTdiYjNiNjRhODg1ZTt0ZW5hbnRJZD05ZjBmZTAyZC00MDY4LTQzMDctYTVkYS02OTdiNjA1OGZhNjQ=",
            "object_id": "4b55d14a-6607-4a56-8615-9c955561da80",
            "subscription_id": "8c781f5c-b4c9-4184-9915-7bb3b64a885e",
            "tenant_id": "9f0fe02d-4068-4307-a5da-697b6058fa64",
            "timeouts": null
          },
          "sensitive_attributes": [],
          "identity_schema_version": 0
        }
      ]
    },
    {
      "mode": "managed",
      "type": "azurerm_policy_definition",
      "name": "aks_encryption_at_host",
      "provider": "provider[\"registry.terraform.io/hashicorp/azurerm\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "description": "Audits AKS clusters where node pools don't have encryption at host enabled",
            "display_name": "ISO 27001 - AKS node pools should have encryption at host enabled",
            "id": "/subscriptions/8c781f5c-b4c9-4184-9915-7bb3b64a885e/providers/Microsoft.Authorization/policyDefinitions/iso27001-aks-encryption-at-host",
            "management_group_id": "",
            "metadata": "{\"category\":\"ISO 27001 - Cryptography\",\"control\":\"A.10.1.1\",\"createdBy\":\"4b55d14a-6607-4a56-8615-9c955561da80\",\"createdOn\":\"2025-10-19T20:15:20.2442556Z\",\"updatedBy\":null,\"updatedOn\":null}",
            "mode": "Indexed",
            "name": "iso27001-aks-encryption-at-host",
            "parameters": "",
            "policy_rule": "{\"if\":{\"allOf\":[{\"equals\":\"Microsoft.ContainerService/managedClusters\",\"field\":\"type\"},{\"count\":{\"field\":\"Microsoft.ContainerService/managedClusters/agentPoolProfiles[*]\",\"where\":{\"anyOf\":[{\"exists\":\"false\",\"field\":\"Microsoft.ContainerService/managedClusters/agentPoolProfiles[*].enableEncryptionAtHost\"},{\"field\":\"Microsoft.ContainerService/managedClusters/agentPoolProfiles[*].enableEncryptionAtHost\",\"notEquals\":true}]}},\"greater\":0}]},\"then\":{\"effect\":\"audit\"}}",
            "policy_type": "Custom",
            "role_definition_ids": [],
            "timeouts": null
          },
          "sensitive_attributes": [],
          "identity_schema_version": 0,
          "private": "eyJlMmJmYjczMC1lY2FhLTExZTYtOGY4OC0zNDM2M2JjN2M0YzAiOnsiY3JlYXRlIjoxODAwMDAwMDAwMDAwLCJkZWxldGUiOjE4MDAwMDAwMDAwMDAsInJlYWQiOjMwMDAwMDAwMDAwMCwidXBkYXRlIjoxODAwMDAwMDAwMDAwfX0="
        }
      ]
    },
    {
      "mode": "managed",
      "type": "azurerm_policy_definition",
      "name": "disk_cmk_required",
      "provider": "provider[\"registry.terraform.io/hashicorp/azurerm\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "description": "Audits managed disks that don't use disk encryption sets with customer-managed keys",
            "display_name": "ISO 27001 - Managed Disks should use customer-managed keys",
            "id": "/subscriptions/8c781f5c-b4c9-4184-9915-7bb3b64a885e/providers/Microsoft.Authorization/policyDefinitions/iso27001-disk-cmk-required",
            "management_group_id": "",
            "metadata": "{\"category\":\"ISO 27001 - Cryptography\",\"control\":\"A.10.1.1\",\"createdBy\":\"4b55d14a-6607-4a56-8615-9c955561da80\",\"createdOn\":\"2025-10-19T20:15:20.1577357Z\",\"updatedBy\":null,\"updatedOn\":null}",
            "mode": "Indexed",
            "name": "iso27001-disk-cmk-required",
            "parameters": "",
            "policy_rule": "{\"if\":{\"allOf\":[{\"equals\":\"Microsoft.Compute/disks\",\"field\":\"type\"},{\"anyOf\":[{\"exists\":\"false\",\"field\":\"Microsoft.Compute/disks/encryption.diskEncryptionSetId\"},{\"equals\":\"\",\"field\":\"Microsoft.Compute/disks/encryption.diskEncryptionSetId\"}]}]},\"then\":{\"effect\":\"audit\"}}",
            "policy_type": "Custom",
            "role_definition_ids": [],
            "timeouts": null
          },
          "sensitive_attributes": [],
          "identity_schema_version": 0,
          "private": "eyJlMmJmYjczMC1lY2FhLTExZTYtOGY4OC0zNDM2M2JjN2M0YzAiOnsiY3JlYXRlIjoxODAwMDAwMDAwMDAwLCJkZWxldGUiOjE4MDAwMDAwMDAwMDAsInJlYWQiOjMwMDAwMDAwMDAwMCwidXBkYXRlIjoxODAwMDAwMDAwMDAwfX0="
        }
      ]
    },
    {
      "mode": "managed",
      "type": "azurerm_policy_definition",
      "name": "kusto_cmk_required",
      "provider": "provider[\"registry.terraform.io/hashicorp/azurerm\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "description": "Audits Data Explorer clusters that don't use customer-managed keys for encryption",
            "display_name": "ISO 27001 - Data Explorer should use customer-managed keys",
            "id": "/subscriptions/8c781f5c-b4c9-4184-9915-7bb3b64a885e/providers/Microsoft.Authorization/policyDefinitions/iso27001-kusto-cmk-required",
            "management_group_id": "",
            "metadata": "{\"category\":\"ISO 27001 - Cryptography\",\"control\":\"A.10.1.1\",\"createdBy\":\"4b55d14a-6607-4a56-8615-9c955561da80\",\"createdOn\":\"2025-10-19T20:15:20.5021117Z\",\"updatedBy\":null,\"updatedOn\":null}",
            "mode": "Indexed",
            "name": "iso27001-kusto-cmk-required",
            "parameters": "",
            "policy_rule": "{\"if\":{\"allOf\":[{\"equals\":\"Microsoft.Kusto/clusters\",\"field\":\"type\"},{\"anyOf\":[{\"exists\":\"false\",\"field\":\"Microsoft.Kusto/clusters/keyVaultProperties.keyName\"},{\"exists\":\"false\",\"field\":\"Microsoft.Kusto/clusters/keyVaultProperties.keyVaultUri\"}]}]},\"then\":{\"effect\":\"audit\"}}",
            "policy_type": "Custom",
            "role_definition_ids": [],
            "timeouts": null
          },
          "sensitive_attributes": [],
          "identity_schema_version": 0,
          "private": "eyJlMmJmYjczMC1lY2FhLTExZTYtOGY4OC0zNDM2M2JjN2M0YzAiOnsiY3JlYXRlIjoxODAwMDAwMDAwMDAwLCJkZWxldGUiOjE4MDAwMDAwMDAwMDAsInJlYWQiOjMwMDAwMDAwMDAwMCwidXBkYXRlIjoxODAwMDAwMDAwMDAwfX0="
        }
      ]
    },
    {
      "mode": "managed",
      "type": "azurerm_policy_definition",
      "name": "kusto_disk_encryption",
      "provider": "provider[\"registry.terraform.io/hashicorp/azurerm\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "description": "Audits Data Explorer (Kusto) clusters without disk encryption",
            "display_name": "ISO 27001 - Data Explorer clusters should have disk encryption enabled",
            "id": "/subscriptions/8c781f5c-b4c9-4184-9915-7bb3b64a885e/providers/Microsoft.Authorization/policyDefinitions/iso27001-kusto-disk-encryption",
            "management_group_id": "",
            "metadata": "{\"category\":\"ISO 27001 - Cryptography\",\"control\":\"A.10.1.1\",\"createdBy\":\"4b55d14a-6607-4a56-8615-9c955561da80\",\"createdOn\":\"2025-10-19T20:15:20.9568864Z\",\"updatedBy\":null,\"updatedOn\":null}",
            "mode": "Indexed",
            "name": "iso27001-kusto-disk-encryption",
            "parameters": "",
            "policy_rule": "{\"if\":{\"allOf\":[{\"equals\":\"Microsoft.Kusto/clusters\",\"field\":\"type\"},{\"anyOf\":[{\"exists\":\"false\",\"field\":\"Microsoft.Kusto/clusters/enableDiskEncryption\"},{\"field\":\"Microsoft.Kusto/clusters/enableDiskEncryption\",\"notEquals\":true}]}]},\"then\":{\"effect\":\"audit\"}}",
            "policy_type": "Custom",
            "role_definition_ids": [],
            "timeouts": null
          },
          "sensitive_attributes": [],
          "identity_schema_version": 0,
          "private": "eyJlMmJmYjczMC1lY2FhLTExZTYtOGY4OC0zNDM2M2JjN2M0YzAiOnsiY3JlYXRlIjoxODAwMDAwMDAwMDAwLCJkZWxldGUiOjE4MDAwMDAwMDAwMDAsInJlYWQiOjMwMDAwMDAwMDAwMCwidXBkYXRlIjoxODAwMDAwMDAwMDAwfX0="
        }
      ]
    },
    {
      "mode": "managed",
      "type": "azurerm_policy_definition",
      "name": "vm_encryption_audit",
      "provider": "provider[\"registry.terraform.io/hashicorp/azurerm\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "description": "Audits VMs that don't have EncryptionAtHost enabled or Azure Disk Encryption applied. This allows either encryption method.",
            "display_name": "Audit VMs without EncryptionAtHost or Azure Disk Encryption",
            "id": "/subscriptions/8c781f5c-b4c9-4184-9915-7bb3b64a885e/providers/Microsoft.Authorization/policyDefinitions/custom-vm-encryption-audit",
            "management_group_id": "",
            "metadata": "{\"category\":\"ISO 27001 - Cryptography\",\"control\":\"A.10.1.1\",\"createdBy\":\"4b55d14a-6607-4a56-8615-9c955561da80\",\"createdOn\":\"2025-10-19T20:15:20.6737221Z\",\"source\":\"Terraform\",\"updatedBy\":null,\"updatedOn\":null,\"version\":\"1.0.0\"}",
            "mode": "Indexed",
            "name": "custom-vm-encryption-audit",
            "parameters": "",
            "policy_rule": "{\"if\":{\"allOf\":[{\"equals\":\"Microsoft.Compute/virtualMachines\",\"field\":\"type\"},{\"anyOf\":[{\"exists\":\"false\",\"field\":\"Microsoft.Compute/virtualMachines/securityProfile.encryptionAtHost\"},{\"field\":\"Microsoft.Compute/virtualMachines/securityProfile.encryptionAtHost\",\"notEquals\":true}]}]},\"then\":{\"details\":{\"existenceCondition\":{\"allOf\":[{\"equals\":\"Microsoft.Azure.Security\",\"field\":\"Microsoft.Compute/virtualMachines/extensions/publisher\"},{\"field\":\"Microsoft.Compute/virtualMachines/extensions/type\",\"in\":[\"AzureDiskEncryption\",\"AzureDiskEncryptionForLinux\"]},{\"equals\":\"Succeeded\",\"field\":\"Microsoft.Compute/virtualMachines/extensions/provisioningState\"}]},\"type\":\"Microsoft.Compute/virtualMachines/extensions\"},\"effect\":\"auditIfNotExists\"}}",
            "policy_type": "Custom",
            "role_definition_ids": [],
            "timeouts": null
          },
          "sensitive_attributes": [],
          "identity_schema_version": 0,
          "private": "eyJlMmJmYjczMC1lY2FhLTExZTYtOGY4OC0zNDM2M2JjN2M0YzAiOnsiY3JlYXRlIjoxODAwMDAwMDAwMDAwLCJkZWxldGUiOjE4MDAwMDAwMDAwMDAsInJlYWQiOjMwMDAwMDAwMDAwMCwidXBkYXRlIjoxODAwMDAwMDAwMDAwfX0="
        }
      ]
    },
    {
      "mode": "managed",
      "type": "azurerm_subscription_policy_assignment",
      "name": "aks_azure_policy_addon",
      "provider": "provider[\"registry.terraform.io/hashicorp/azurerm\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "description": "Enables policy enforcement within AKS clusters",
            "display_name": "ISO 27001 - AKS clusters should have Azure Policy add-on enabled",
            "enforce": true,
            "id": "/subscriptions/8c781f5c-b4c9-4184-9915-7bb3b64a885e/providers/Microsoft.Authorization/policyAssignments/iso27001-aks-policy-addon",
            "identity": [
              {
                "identity_ids": null,
                "principal_id": "962c8476-c5ae-4daa-b15b-37761e806198",
                "tenant_id": "9f0fe02d-4068-4307-a5da-697b6058fa64",
                "type": "SystemAssigned"
              }
            ],
            "location": "swedencentral",
            "metadata": "{\"assignedBy\":\"Terraform\",\"category\":\"ISO 27001 - Cryptography\",\"control\":\"A.10.1.1\",\"createdBy\":\"4b55d14a-6607-4a56-8615-9c955561da80\",\"createdOn\":\"2025-10-19T20:24:04.2155903Z\",\"updatedBy\":null,\"updatedOn\":null}",
            "name": "iso27001-aks-policy-addon",
            "non_compliance_message": [],
            "not_scopes": null,
            "overrides": [],
            "parameters": "",
            "policy_definition_id": "/providers/Microsoft.Authorization/policyDefinitions/a8eff44f-8c92-45c3-a3fb-9880802d67a7",
            "resource_selectors": [],
            "subscription_id": "/subscriptions/8c781f5c-b4c9-4184-9915-7bb3b64a885e",
            "timeouts": null
          },
          "sensitive_attributes": [],
          "identity_schema_version": 0,
          "private": "eyJlMmJmYjczMC1lY2FhLTExZTYtOGY4OC0zNDM2M2JjN2M0YzAiOnsiY3JlYXRlIjoxODAwMDAwMDAwMDAwLCJkZWxldGUiOjE4MDAwMDAwMDAwMDAsInJlYWQiOjMwMDAwMDAwMDAwMCwidXBkYXRlIjoxODAwMDAwMDAwMDAwfX0=",
          "dependencies": [
            "data.azurerm_client_config.current"
          ]
        }
      ]
    },
    {
      "mode": "managed",
      "type": "azurerm_subscription_policy_assignment",
      "name": "aks_encryption_at_host_assignment",
      "provider": "provider[\"registry.terraform.io/hashicorp/azurerm\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "description": "Ensures AKS node pools use encryption at host for data security",
            "display_name": "ISO 27001 - AKS node pools must have encryption at host",
            "enforce": true,
            "id": "/subscriptions/8c781f5c-b4c9-4184-9915-7bb3b64a885e/providers/Microsoft.Authorization/policyAssignments/iso27001-aks-encrypt-host",
            "identity": [],
            "location": "",
            "metadata": "{\"assignedBy\":\"Terraform\",\"category\":\"ISO 27001 - Cryptography\",\"control\":\"A.10.1.1\",\"createdBy\":\"4b55d14a-6607-4a56-8615-9c955561da80\",\"createdOn\":\"2025-10-19T20:16:57.5117723Z\",\"updatedBy\":null,\"updatedOn\":null}",
            "name": "iso27001-aks-encrypt-host",
            "non_compliance_message": [],
            "not_scopes": [],
            "overrides": [],
            "parameters": "",
            "policy_definition_id": "/subscriptions/8c781f5c-b4c9-4184-9915-7bb3b64a885e/providers/Microsoft.Authorization/policyDefinitions/iso27001-aks-encryption-at-host",
            "resource_selectors": [],
            "subscription_id": "/subscriptions/8c781f5c-b4c9-4184-9915-7bb3b64a885e",
            "timeouts": null
          },
          "sensitive_attributes": [],
          "identity_schema_version": 0,
          "private": "eyJlMmJmYjczMC1lY2FhLTExZTYtOGY4OC0zNDM2M2JjN2M0YzAiOnsiY3JlYXRlIjoxODAwMDAwMDAwMDAwLCJkZWxldGUiOjE4MDAwMDAwMDAwMDAsInJlYWQiOjMwMDAwMDAwMDAwMCwidXBkYXRlIjoxODAwMDAwMDAwMDAwfX0=",
          "dependencies": [
            "azurerm_policy_definition.aks_encryption_at_host",
            "data.azurerm_client_config.current"
          ]
        }
      ]
    },
    {
      "mode": "managed",
      "type": "azurerm_subscription_policy_assignment",
      "name": "disk_cmk_assignment",
      "provider": "provider[\"registry.terraform.io/hashicorp/azurerm\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "description": "Ensures managed disks use disk encryption sets with CMK",
            "display_name": "ISO 27001 - Managed Disks must use customer-managed keys",
            "enforce": true,
            "id": "/subscriptions/8c781f5c-b4c9-4184-9915-7bb3b64a885e/providers/Microsoft.Authorization/policyAssignments/iso27001-disk-cmk",
            "identity": [],
            "location": "",
            "metadata": "{\"assignedBy\":\"Terraform\",\"category\":\"ISO 27001 - Cryptography\",\"control\":\"A.10.1.1\",\"createdBy\":\"4b55d14a-6607-4a56-8615-9c955561da80\",\"createdOn\":\"2025-10-19T20:16:57.0814137Z\",\"updatedBy\":null,\"updatedOn\":null}",
            "name": "iso27001-disk-cmk",
            "non_compliance_message": [],
            "not_scopes": [],
            "overrides": [],
            "parameters": "",
            "policy_definition_id": "/subscriptions/8c781f5c-b4c9-4184-9915-7bb3b64a885e/providers/Microsoft.Authorization/policyDefinitions/iso27001-disk-cmk-required",
            "resource_selectors": [],
            "subscription_id": "/subscriptions/8c781f5c-b4c9-4184-9915-7bb3b64a885e",
            "timeouts": null
          },
          "sensitive_attributes": [],
          "identity_schema_version": 0,
          "private": "eyJlMmJmYjczMC1lY2FhLTExZTYtOGY4OC0zNDM2M2JjN2M0YzAiOnsiY3JlYXRlIjoxODAwMDAwMDAwMDAwLCJkZWxldGUiOjE4MDAwMDAwMDAwMDAsInJlYWQiOjMwMDAwMDAwMDAwMCwidXBkYXRlIjoxODAwMDAwMDAwMDAwfX0=",
          "dependencies": [
            "azurerm_policy_definition.disk_cmk_required",
            "data.azurerm_client_config.current"
          ]
        }
      ]
    },
    {
      "mode": "managed",
      "type": "azurerm_subscription_policy_assignment",
      "name": "keyvault_purge_protection",
      "provider": "provider[\"registry.terraform.io/hashicorp/azurerm\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "description": "Prevents permanent deletion of keys, secrets, and certificates",
            "display_name": "ISO 27001 - Key Vaults should have purge protection enabled",
            "enforce": true,
            "id": "/subscriptions/8c781f5c-b4c9-4184-9915-7bb3b64a885e/providers/Microsoft.Authorization/policyAssignments/iso27001-kv-purge-protect",
            "identity": [],
            "location": "",
            "metadata": "{\"assignedBy\":\"Terraform\",\"category\":\"ISO 27001 - Cryptography\",\"control\":\"A.10.1.1\",\"createdBy\":\"4b55d14a-6607-4a56-8615-9c955561da80\",\"createdOn\":\"2025-10-19T20:15:20.7234186Z\",\"updatedBy\":null,\"updatedOn\":null}",
            "name": "iso27001-kv-purge-protect",
            "non_compliance_message": [],
            "not_scopes": [],
            "overrides": [],
            "parameters": "",
            "policy_definition_id": "/providers/Microsoft.Authorization/policyDefinitions/0b60c0b2-2dc2-4e1c-b5c9-abbed971de53",
            "resource_selectors": [],
            "subscription_id": "/subscriptions/8c781f5c-b4c9-4184-9915-7bb3b64a885e",
            "timeouts": null
          },
          "sensitive_attributes": [],
          "identity_schema_version": 0,
          "private": "eyJlMmJmYjczMC1lY2FhLTExZTYtOGY4OC0zNDM2M2JjN2M0YzAiOnsiY3JlYXRlIjoxODAwMDAwMDAwMDAwLCJkZWxldGUiOjE4MDAwMDAwMDAwMDAsInJlYWQiOjMwMDAwMDAwMDAwMCwidXBkYXRlIjoxODAwMDAwMDAwMDAwfX0=",
          "dependencies": [
            "data.azurerm_client_config.current"
          ]
        }
      ]
    },
    {
      "mode": "managed",
      "type": "azurerm_subscription_policy_assignment",
      "name": "keyvault_soft_delete",
      "provider": "provider[\"registry.terraform.io/hashicorp/azurerm\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "description": "Protects against accidental deletion of encryption keys",
            "display_name": "ISO 27001 - Key Vaults should have soft delete enabled",
            "enforce": true,
            "id": "/subscriptions/8c781f5c-b4c9-4184-9915-7bb3b64a885e/providers/Microsoft.Authorization/policyAssignments/iso27001-kv-soft-delete",
            "identity": [],
            "location": "",
            "metadata": "{\"assignedBy\":\"Terraform\",\"category\":\"ISO 27001 - Cryptography\",\"control\":\"A.10.1.1\",\"createdBy\":\"4b55d14a-6607-4a56-8615-9c955561da80\",\"createdOn\":\"2025-10-19T20:15:20.7722113Z\",\"updatedBy\":null,\"updatedOn\":null}",
            "name": "iso27001-kv-soft-delete",
            "non_compliance_message": [],
            "not_scopes": [],
            "overrides": [],
            "parameters": "",
            "policy_definition_id": "/providers/Microsoft.Authorization/policyDefinitions/1e66c121-a66a-4b1f-9b83-0fd99bf0fc2d",
            "resource_selectors": [],
            "subscription_id": "/subscriptions/8c781f5c-b4c9-4184-9915-7bb3b64a885e",
            "timeouts": null
          },
          "sensitive_attributes": [],
          "identity_schema_version": 0,
          "private": "eyJlMmJmYjczMC1lY2FhLTExZTYtOGY4OC0zNDM2M2JjN2M0YzAiOnsiY3JlYXRlIjoxODAwMDAwMDAwMDAwLCJkZWxldGUiOjE4MDAwMDAwMDAwMDAsInJlYWQiOjMwMDAwMDAwMDAwMCwidXBkYXRlIjoxODAwMDAwMDAwMDAwfX0=",
          "dependencies": [
            "data.azurerm_client_config.current"
          ]
        }
      ]
    },
    {
      "mode": "managed",
      "type": "azurerm_subscription_policy_assignment",
      "name": "kusto_cmk_assignment",
      "provider": "provider[\"registry.terraform.io/hashicorp/azurerm\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "description": "Ensures Data Explorer uses CMK for encryption at rest",
            "display_name": "ISO 27001 - Data Explorer must use customer-managed keys",
            "enforce": true,
            "id": "/subscriptions/8c781f5c-b4c9-4184-9915-7bb3b64a885e/providers/Microsoft.Authorization/policyAssignments/iso27001-kusto-cmk",
            "identity": [],
            "location": "",
            "metadata": "{\"assignedBy\":\"Terraform\",\"category\":\"ISO 27001 - Cryptography\",\"control\":\"A.10.1.1\",\"createdBy\":\"4b55d14a-6607-4a56-8615-9c955561da80\",\"createdOn\":\"2025-10-19T20:16:57.1224161Z\",\"updatedBy\":null,\"updatedOn\":null}",
            "name": "iso27001-kusto-cmk",
            "non_compliance_message": [],
            "not_scopes": [],
            "overrides": [],
            "parameters": "",
            "policy_definition_id": "/subscriptions/8c781f5c-b4c9-4184-9915-7bb3b64a885e/providers/Microsoft.Authorization/policyDefinitions/iso27001-kusto-cmk-required",
            "resource_selectors": [],
            "subscription_id": "/subscriptions/8c781f5c-b4c9-4184-9915-7bb3b64a885e",
            "timeouts": null
          },
          "sensitive_attributes": [],
          "identity_schema_version": 0,
          "private": "eyJlMmJmYjczMC1lY2FhLTExZTYtOGY4OC0zNDM2M2JjN2M0YzAiOnsiY3JlYXRlIjoxODAwMDAwMDAwMDAwLCJkZWxldGUiOjE4MDAwMDAwMDAwMDAsInJlYWQiOjMwMDAwMDAwMDAwMCwidXBkYXRlIjoxODAwMDAwMDAwMDAwfX0=",
          "dependencies": [
            "azurerm_policy_definition.kusto_cmk_required",
            "data.azurerm_client_config.current"
          ]
        }
      ]
    },
    {
      "mode": "managed",
      "type": "azurerm_subscription_policy_assignment",
      "name": "kusto_disk_encryption_assignment",
      "provider": "provider[\"registry.terraform.io/hashicorp/azurerm\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "description": "Ensures Data Explorer clusters have disk encryption enabled",
            "display_name": "ISO 27001 - Data Explorer clusters require disk encryption",
            "enforce": true,
            "id": "/subscriptions/8c781f5c-b4c9-4184-9915-7bb3b64a885e/providers/Microsoft.Authorization/policyAssignments/iso27001-kusto-encryption",
            "identity": [],
            "location": "",
            "metadata": "{\"assignedBy\":\"Terraform\",\"category\":\"ISO 27001 - Cryptography\",\"control\":\"A.10.1.1\",\"createdBy\":\"4b55d14a-6607-4a56-8615-9c955561da80\",\"createdOn\":\"2025-10-19T20:16:58.1661126Z\",\"updatedBy\":null,\"updatedOn\":null}",
            "name": "iso27001-kusto-encryption",
            "non_compliance_message": [],
            "not_scopes": [],
            "overrides": [],
            "parameters": "",
            "policy_definition_id": "/subscriptions/8c781f5c-b4c9-4184-9915-7bb3b64a885e/providers/Microsoft.Authorization/policyDefinitions/iso27001-kusto-disk-encryption",
            "resource_selectors": [],
            "subscription_id": "/subscriptions/8c781f5c-b4c9-4184-9915-7bb3b64a885e",
            "timeouts": null
          },
          "sensitive_attributes": [],
          "identity_schema_version": 0,
          "private": "eyJlMmJmYjczMC1lY2FhLTExZTYtOGY4OC0zNDM2M2JjN2M0YzAiOnsiY3JlYXRlIjoxODAwMDAwMDAwMDAwLCJkZWxldGUiOjE4MDAwMDAwMDAwMDAsInJlYWQiOjMwMDAwMDAwMDAwMCwidXBkYXRlIjoxODAwMDAwMDAwMDAwfX0=",
          "dependencies": [
            "azurerm_policy_definition.kusto_disk_encryption",
            "data.azurerm_client_config.current"
          ]
        }
      ]
    },
    {
      "mode": "managed",
      "type": "azurerm_subscription_policy_assignment",
      "name": "sql_tde_cmk_required",
      "provider": "provider[\"registry.terraform.io/hashicorp/azurerm\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "description": "Transparent Data Encryption should use customer-managed keys",
            "display_name": "ISO 27001 - SQL Databases should use customer-managed keys for TDE",
            "enforce": true,
            "id": "/subscriptions/8c781f5c-b4c9-4184-9915-7bb3b64a885e/providers/Microsoft.Authorization/policyAssignments/iso27001-sql-tde-cmk",
            "identity": [],
            "location": "",
            "metadata": "{\"assignedBy\":\"Terraform\",\"category\":\"ISO 27001 - Cryptography\",\"control\":\"A.10.1.1\",\"createdBy\":\"4b55d14a-6607-4a56-8615-9c955561da80\",\"createdOn\":\"2025-10-19T20:16:56.1307804Z\",\"updatedBy\":null,\"updatedOn\":null}",
            "name": "iso27001-sql-tde-cmk",
            "non_compliance_message": [],
            "not_scopes": [],
            "overrides": [],
            "parameters": "",
            "policy_definition_id": "/providers/Microsoft.Authorization/policyDefinitions/0a370ff3-6cab-4e85-8995-295fd854c5b8",
            "resource_selectors": [],
            "subscription_id": "/subscriptions/8c781f5c-b4c9-4184-9915-7bb3b64a885e",
            "timeouts": null
          },
          "sensitive_attributes": [],
          "identity_schema_version": 0,
          "private": "eyJlMmJmYjczMC1lY2FhLTExZTYtOGY4OC0zNDM2M2JjN2M0YzAiOnsiY3JlYXRlIjoxODAwMDAwMDAwMDAwLCJkZWxldGUiOjE4MDAwMDAwMDAwMDAsInJlYWQiOjMwMDAwMDAwMDAwMCwidXBkYXRlIjoxODAwMDAwMDAwMDAwfX0=",
          "dependencies": [
            "data.azurerm_client_config.current"
          ]
        }
      ]
    },
    {
      "mode": "managed",
      "type": "azurerm_subscription_policy_assignment",
      "name": "storage_cmk_required",
      "provider": "provider[\"registry.terraform.io/hashicorp/azurerm\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "description": "Audit storage accounts that don't use customer-managed keys for encryption at rest",
            "display_name": "ISO 27001 - Storage Accounts should use customer-managed keys",
            "enforce": true,
            "id": "/subscriptions/8c781f5c-b4c9-4184-9915-7bb3b64a885e/providers/Microsoft.Authorization/policyAssignments/iso27001-storage-cmk",
            "identity": [],
            "location": "",
            "metadata": "{\"assignedBy\":\"Terraform\",\"category\":\"ISO 27001 - Cryptography\",\"control\":\"A.10.1.1\",\"createdBy\":\"4b55d14a-6607-4a56-8615-9c955561da80\",\"createdOn\":\"2025-10-19T20:15:20.8337473Z\",\"updatedBy\":null,\"updatedOn\":null}",
            "name": "iso27001-storage-cmk",
            "non_compliance_message": [],
            "not_scopes": [],
            "overrides": [],
            "parameters": "",
            "policy_definition_id": "/providers/Microsoft.Authorization/policyDefinitions/6fac406b-40ca-413b-bf8e-0bf964659c25",
            "resource_selectors": [],
            "subscription_id": "/subscriptions/8c781f5c-b4c9-4184-9915-7bb3b64a885e",
            "timeouts": null
          },
          "sensitive_attributes": [],
          "identity_schema_version": 0,
          "private": "eyJlMmJmYjczMC1lY2FhLTExZTYtOGY4OC0zNDM2M2JjN2M0YzAiOnsiY3JlYXRlIjoxODAwMDAwMDAwMDAwLCJkZWxldGUiOjE4MDAwMDAwMDAwMDAsInJlYWQiOjMwMDAwMDAwMDAwMCwidXBkYXRlIjoxODAwMDAwMDAwMDAwfX0=",
          "dependencies": [
            "data.azurerm_client_config.current"
          ]
        }
      ]
    },
    {
      "mode": "managed",
      "type": "azurerm_subscription_policy_assignment",
      "name": "storage_disable_public_access",
      "provider": "provider[\"registry.terraform.io/hashicorp/azurerm\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "description": "Disables anonymous public read access to containers and blobs",
            "display_name": "ISO 27001 - Storage Accounts should disable public blob access",
            "enforce": true,
            "id": "/subscriptions/8c781f5c-b4c9-4184-9915-7bb3b64a885e/providers/Microsoft.Authorization/policyAssignments/iso27001-storage-no-public",
            "identity": [],
            "location": "",
            "metadata": "{\"assignedBy\":\"Terraform\",\"category\":\"ISO 27001 - Cryptography\",\"control\":\"A.10.1.1\",\"createdBy\":\"4b55d14a-6607-4a56-8615-9c955561da80\",\"createdOn\":\"2025-10-19T20:15:20.8577385Z\",\"updatedBy\":null,\"updatedOn\":null}",
            "name": "iso27001-storage-no-public",
            "non_compliance_message": [],
            "not_scopes": [],
            "overrides": [],
            "parameters": "",
            "policy_definition_id": "/providers/Microsoft.Authorization/policyDefinitions/4fa4b6c0-31ca-4c0d-b10d-24b96f62a751",
            "resource_selectors": [],
            "subscription_id": "/subscriptions/8c781f5c-b4c9-4184-9915-7bb3b64a885e",
            "timeouts": null
          },
          "sensitive_attributes": [],
          "identity_schema_version": 0,
          "private": "eyJlMmJmYjczMC1lY2FhLTExZTYtOGY4OC0zNDM2M2JjN2M0YzAiOnsiY3JlYXRlIjoxODAwMDAwMDAwMDAwLCJkZWxldGUiOjE4MDAwMDAwMDAwMDAsInJlYWQiOjMwMDAwMDAwMDAwMCwidXBkYXRlIjoxODAwMDAwMDAwMDAwfX0=",
          "dependencies": [
            "data.azurerm_client_config.current"
          ]
        }
      ]
    },
    {
      "mode": "managed",
      "type": "azurerm_subscription_policy_assignment",
      "name": "storage_https_required",
      "provider": "provider[\"registry.terraform.io/hashicorp/azurerm\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "description": "Enforces HTTPS-only access to storage accounts for data in transit encryption",
            "display_name": "ISO 27001 - Storage Accounts require secure transfer (HTTPS)",
            "enforce": true,
            "id": "/subscriptions/8c781f5c-b4c9-4184-9915-7bb3b64a885e/providers/Microsoft.Authorization/policyAssignments/iso27001-storage-https",
            "identity": [],
            "location": "",
            "metadata": "{\"assignedBy\":\"Terraform\",\"category\":\"ISO 27001 - Cryptography\",\"control\":\"A.10.1.1\",\"createdBy\":\"4b55d14a-6607-4a56-8615-9c955561da80\",\"createdOn\":\"2025-10-19T20:15:21.0281072Z\",\"updatedBy\":null,\"updatedOn\":null}",
            "name": "iso27001-storage-https",
            "non_compliance_message": [],
            "not_scopes": [],
            "overrides": [],
            "parameters": "",
            "policy_definition_id": "/providers/Microsoft.Authorization/policyDefinitions/404c3081-a854-4457-ae30-26a93ef643f9",
            "resource_selectors": [],
            "subscription_id": "/subscriptions/8c781f5c-b4c9-4184-9915-7bb3b64a885e",
            "timeouts": null
          },
          "sensitive_attributes": [],
          "identity_schema_version": 0,
          "private": "eyJlMmJmYjczMC1lY2FhLTExZTYtOGY4OC0zNDM2M2JjN2M0YzAiOnsiY3JlYXRlIjoxODAwMDAwMDAwMDAwLCJkZWxldGUiOjE4MDAwMDAwMDAwMDAsInJlYWQiOjMwMDAwMDAwMDAwMCwidXBkYXRlIjoxODAwMDAwMDAwMDAwfX0=",
          "dependencies": [
            "data.azurerm_client_config.current"
          ]
        }
      ]
    },
    {
      "mode": "managed",
      "type": "azurerm_subscription_policy_assignment",
      "name": "vm_encryption_audit",
      "provider": "provider[\"registry.terraform.io/hashicorp/azurerm\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "description": "Audits VMs to ensure they have either EncryptionAtHost or Azure Disk Encryption. Does not block deployment. Applies to both Windows and Linux VMs.",
            "display_name": "Audit VMs - Require EncryptionAtHost OR Azure Disk Encryption",
            "enforce": true,
            "id": "/subscriptions/8c781f5c-b4c9-4184-9915-7bb3b64a885e/providers/Microsoft.Authorization/policyAssignments/vm-encryption-audit",
            "identity": [
              {
                "identity_ids": [],
                "principal_id": "139da285-590a-457d-97d2-b2251f08fb44",
                "tenant_id": "9f0fe02d-4068-4307-a5da-697b6058fa64",
                "type": "SystemAssigned"
              }
            ],
            "location": "swedencentral",
            "metadata": "{\"assignedBy\":\"Terraform\",\"category\":\"ISO 27001 - Cryptography\",\"control\":\"A.10.1.1\",\"createdBy\":\"4b55d14a-6607-4a56-8615-9c955561da80\",\"createdOn\":\"2025-10-19T20:17:06.1721465Z\",\"updatedBy\":null,\"updatedOn\":null}",
            "name": "vm-encryption-audit",
            "non_compliance_message": [],
            "not_scopes": [],
            "overrides": [],
            "parameters": "",
            "policy_definition_id": "/subscriptions/8c781f5c-b4c9-4184-9915-7bb3b64a885e/providers/Microsoft.Authorization/policyDefinitions/custom-vm-encryption-audit",
            "resource_selectors": [],
            "subscription_id": "/subscriptions/8c781f5c-b4c9-4184-9915-7bb3b64a885e",
            "timeouts": null
          },
          "sensitive_attributes": [],
          "identity_schema_version": 0,
          "private": "eyJlMmJmYjczMC1lY2FhLTExZTYtOGY4OC0zNDM2M2JjN2M0YzAiOnsiY3JlYXRlIjoxODAwMDAwMDAwMDAwLCJkZWxldGUiOjE4MDAwMDAwMDAwMDAsInJlYWQiOjMwMDAwMDAwMDAwMCwidXBkYXRlIjoxODAwMDAwMDAwMDAwfX0=",
          "dependencies": [
            "azurerm_policy_definition.vm_encryption_audit",
            "data.azurerm_client_config.current"
          ]
        }
      ]
    }
  ],
  "check_results": [
    {
      "object_kind": "var",
      "config_addr": "var.enforcement_mode",
      "status": "pass",
      "objects": [
        {
          "object_addr": "var.enforcement_mode",
          "status": "pass"
        }
      ]
    }
  ]
}
